<!DOCTYPE html>
<html lang="en">
  <head>
      <!-- GA4 base -->
  <script>
    // Load Google Analytics script with error handling
    const gaScript = document.createElement('script');
    gaScript.async = true;
    gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-R7SFT14JN7';
    
    gaScript.onerror = function() {
      console.warn('Google Analytics script failed to load');
      window.gtagLoadError = true;
    };
    
    gaScript.onload = function() {
      console.log('Google Analytics script loaded successfully');
      window.gtagLoadSuccess = true;
    };
    
    document.head.appendChild(gaScript);
  </script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ 
      try { 
        if (window.gtagLoadError) {
          console.warn('Google Analytics not available, skipping tracking');
          return;
        }
        dataLayer.push(arguments); 
      } catch(e){ 
        console.log('Analytics error:', e);
      }
    }

    // Enable "DebugView" only when ?debug=1 is present
    var DEBUG = location.search.includes('debug=1');

    try {
      gtag('js', new Date());
      gtag('config', 'G-R7SFT14JN7', {
        send_page_view: true,              // make the initial page_view explicit
        cookie_domain: 'auto',
        cookie_flags: 'SameSite=None;Secure',
        debug_mode: DEBUG,                 // lets you see events instantly in Admin â†’ DebugView
        // Enhanced measurement
        enhanced_measurement: true,
        // Custom parameters for service business
        custom_map: {
          'custom_parameter_1': 'service_type',
          'custom_parameter_2': 'business_size'
        }
      });
    } catch(e) {
      console.warn('Google Analytics initialization failed:', e);
    }
  </script>

  <!-- SPA/Client-side routing support for GA4 -->
  <script>
  (function(){
    if (!window.gtag || window.gtagLoadError) return;

    function sendPV(){
      try {
        gtag('event', 'page_view', {
          page_location: location.href,
          page_path: location.pathname + location.search + location.hash,
          page_title: document.title
        });
      } catch(e) {
        console.warn('Google Analytics page view tracking failed:', e);
      }
    }

    // Fire on history API changes (pushState/replaceState)
    ['pushState','replaceState'].forEach(function(m){
      var orig = history[m];
      history[m] = function(){
        var ret = orig.apply(this, arguments);
        sendPV();
        return ret;
      };
    });

    // Fire on back/forward & hash changes
    window.addEventListener('popstate', sendPV);
    window.addEventListener('hashchange', sendPV);
  })();
  </script>

  <!-- Facebook Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    
    // Add error handling for Facebook Pixel script loading
    t.onerror = function() {
      console.warn('Facebook Pixel script failed to load');
      // Set a flag to indicate pixel failed to load
      window.fbqLoadError = true;
    };
    
    t.onload = function() {
      console.log('Facebook Pixel script loaded successfully');
      // Set a flag to indicate pixel loaded successfully
      window.fbqLoadSuccess = true;
    };
    
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    
    // Initialize pixel with error handling
    try {
      fbq('init', '1291420825372627');
      fbq('track', 'PageView');
    } catch(e) {
      console.warn('Facebook Pixel initialization failed:', e);
    }
  </script>
  <!-- End Facebook Pixel Code -->
    
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#1e40af" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="PixelWave Marketing" />
    
    <!-- Add links for web app manifest icons -->
    <link rel="icon" type="image/png" href="/web-app-manifest-192x192.png" sizes="192x192" />
    <link rel="icon" type="image/png" href="/web-app-manifest-512x512.png" sizes="512x512" />

    <!-- Basic fallback meta tags - React Helmet will override these -->
    <title>PixelWave Marketing</title>
    <meta name="description" content="Digital marketing and web development services">
    
    <!-- Static meta tags that don't change -->
    <meta name="language" content="English">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="format-detection" content="telephone=yes">
    
    <!-- Bing Webmaster Tools -->
    <meta name="msvalidate.01" content="D74B24FADC0EA14BCD046E165FE7ED9B" />
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    
    <!-- Schema.org markup for Google -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "PixelWave Marketing",
      "description": "Digital marketing and web development services to help Nashville businesses thrive",
      "url": "https://usepixelwave.com",
      "logo": "https://usepixelwave.com/logo.svg",
      "sameAs": [
        "https://www.facebook.com/61577166790673",
        "https://www.instagram.com/usepixelwave/",
        "https://www.linkedin.com/company/pixelwave-marketing"
      ],
      "foundingDate": "2023",
      "numberOfEmployees": "5-10",
      "knowsAbout": [
        "Digital Marketing",
        "Web Development", 
        "Search Engine Optimization",
        "Google Ads",
        "Social Media Marketing",
        "Content Marketing",
        "Analytics",
        "Brand Identity",
        "E-commerce Development"
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Digital Marketing Services",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Web Development",
              "description": "Custom responsive websites and e-commerce solutions"
            }
          },
          {
            "@type": "Offer", 
            "itemOffered": {
              "@type": "Service",
              "name": "Digital Marketing",
              "description": "Google Ads, SEO, and social media marketing"
            }
          }
        ]
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "reviewCount": "25"
      }
    }
    </script>

    <!-- LocalBusiness Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "PixelWave Marketing",
      "image": "https://usepixelwave.com/PixelWave.png",
      "url": "https://usepixelwave.com",
      "telephone": "+18024555570",
      "email": "usepixelwave@gmail.com",
      "priceRange": "$$",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Nashville",
        "addressLocality": "Nashville",
        "addressRegion": "TN",
        "postalCode": "37201",
        "addressCountry": "US"
      },
      "areaServed": [
        {"@type": "City", "name": "Nashville TN"},
        {"@type": "City", "name": "Franklin TN"},
        {"@type": "City", "name": "Brentwood TN"},
        {"@type": "City", "name": "Murfreesboro TN"}
      ],
      "openingHoursSpecification": [{"@type": "OpeningHoursSpecification", "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"], "opens": "09:00", "closes": "17:00"}],
      "sameAs": [
        "https://www.facebook.com/61577166790673",
        "https://www.instagram.com/usepixelwave/",
        "https://www.linkedin.com/company/pixelwave-marketing"
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Digital Marketing Services",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Web Development",
              "description": "Custom responsive websites and e-commerce solutions"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Digital Marketing",
              "description": "Google Ads, SEO, and social media marketing"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "AI Chatbot Solutions",
              "description": "24/7 automated customer support and lead generation"
            }
          }
        ]
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "reviewCount": "25"
      }
    }
    </script>


    <!-- Responsive Design -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- Preload critical assets -->
    <link rel="preload" as="image" href="/PixelWave.png" fetchpriority="high" type="image/png" media="(min-width: 1px)">
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" crossorigin onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="https://ai-chatbot-p.netlify.app">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    
    <!-- Preconnect to critical third-party origins -->
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Google-specific optimizations -->
    <!-- Replace with your actual Google Search Console verification code -->
    <!-- <meta name="google-site-verification" content="your-verification-code-here"> -->
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="bingbot" content="index, follow">
    
    <!-- Enhanced mobile optimization -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Performance hints -->
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
    
  </head>
  <body>
    <!-- Facebook Pixel noscript fallback -->
    <noscript>
      <img height="1" width="1" style="display:none"
           src="https://www.facebook.com/tr?id=1291420825372627&ev=PageView&noscript=1" />
    </noscript>
    
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- Service Worker Registration with Auto-Update -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
              
              // Check for updates every time the page loads
              registration.addEventListener('updatefound', () => {
                console.log('New service worker found, updating...');
                const newWorker = registration.installing;
                
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New service worker is available, force reload
                    console.log('New service worker installed, reloading page...');
                    window.location.reload(true);
                  }
                });
              });
              
              // Force check for updates
              registration.update();
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
    </script>
    
    <!-- AI Chatbot Script loaded via React useEffect -->
  </body>
</html>
